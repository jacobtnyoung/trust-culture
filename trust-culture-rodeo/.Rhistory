library( dplyr )    # for working with the data
library( reshape2 ) # for reworking the data
library( ggplot2 )  # for plotting
# ================================================================== #
# Function to create the agreement matrix ----
responses <- matrix( rbinom( n = 500, size = 1, prob = 0.1 ), ncol = 5 )
# ================================================================== #
# Function to create the agreement matrix ----
# The equation comes from pg. 65 of Purzycki, B. G., & Jamieson-Lane, A. (2016). AnthroTools. Cross-Cultural Research, 51(1), 51-74. doi:10.1177/1069397116680352.
DiscountedAgreementMatrix <-
function( response.mat, n.responses ){
discounted.matrix= matrix( 0, nrow( response.mat ),nrow( response.mat ) )
for( i in 1:nrow( discounted.matrix ) ){
for( j in 1:ncol( discounted.matrix ) ){
discounted.matrix[i,j] <- mean( response.mat[i,] == response.mat[j,], na.rm = TRUE ) # Create the average number of items i and j agree on
}
}
discounted.matrix <- ( discounted.matrix*n.responses -1 ) / (n.responses-1 ) # Correct the average agreement for guessing
diag( discounted.matrix ) <- 0 # set the diagonal to zero
discounted.matrix[is.finite(discounted.matrix) == FALSE] <- 0 # adjust Inf values to zero (if any)
return( discounted.matrix )
}
agreement <- DiscountedAgreementMatrix( responses, 2 )
# ================================================================== #
# Plotting results ----
# Create data for the plot.
dat.for.plot <- function( cormat ){
dd <- as.dist( ( 1-cormat )/2 ) # Use correlation between variables as distance
hc <- hclust( dd )
cormat <-cormat[hc$order, hc$order]
cormat[lower.tri( cormat )] <- NA # set the lower part of the triangle as missing (redundant information)
cor.dat <- melt( cormat, na.rm = TRUE ) # create the dataframe
return( cor.dat )
}
# Assign the agreement matrix to the object to plot
agreement.dat <- dat.for.plot( agreement )
# Plot the agreement scores/correlations
ggheatmap.T <- ggplot( data = agreement.dat, aes( Var2, Var1, fill = value ) ) +
geom_tile( color = "white" ) +
scale_fill_gradient2( low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c( -1,1 ), space = "Lab",
name="Agreement" ) +
theme_minimal() +
coord_fixed() +
theme(
axis.title.x = element_blank(), axis.title.y = element_blank(),
axis.text.x=element_blank(), axis.text.y=element_blank(),
panel.grid.major = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
axis.ticks = element_blank(),
legend.justification = c(1, 0),
legend.position = c(0.6, 0.7),
legend.direction = "horizontal") +
guides(fill = guide_colorbar( barwidth = 7, barheight = 1,
title.position = "top", title.hjust = 0.5) ) +
ggtitle( "Plot of Agreement for Trust Items" )
print( ggheatmap.T )
knowledge <- runif( n = 5, min = .80 , max = 0.99 )
dim(agreement)
agreement[1:10,1:10]
n <- 5
dims <- n*n
n
dims
n <- 5
n.cells <- n*n
agreement <- matrix(
runif( n = n.cells, min = .80 , max = 0.99 ),
ncol = n
)
agreement
# Clear the workspace
rm( list = ls() )
library( dplyr )    # for working with the data
library( reshape2 ) # for reworking the data
library( ggplot2 )  # for plotting
# ================================================================== #
# Function to create the agreement matrix ----
n <- 5
n.cells <- n*n
agreement <- matrix(
runif( n = n.cells, min = .80 , max = 0.99 ),
ncol = n
)
# ================================================================== #
# Plotting results ----
# Create data for the plot.
dat.for.plot <- function( cormat ){
dd <- as.dist( ( 1-cormat )/2 ) # Use correlation between variables as distance
hc <- hclust( dd )
cormat <-cormat[hc$order, hc$order]
cormat[lower.tri( cormat )] <- NA # set the lower part of the triangle as missing (redundant information)
cor.dat <- melt( cormat, na.rm = TRUE ) # create the dataframe
return( cor.dat )
}
# Assign the agreement matrix to the object to plot
agreement.dat <- dat.for.plot( agreement )
# Plot the agreement scores/correlations
ggheatmap.T <- ggplot( data = agreement.dat, aes( Var2, Var1, fill = value ) ) +
geom_tile( color = "white" ) +
scale_fill_gradient2( low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c( -1,1 ), space = "Lab",
name="Agreement" ) +
theme_minimal() +
coord_fixed() +
theme(
axis.title.x = element_blank(), axis.title.y = element_blank(),
axis.text.x=element_blank(), axis.text.y=element_blank(),
panel.grid.major = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
axis.ticks = element_blank(),
legend.justification = c(1, 0),
legend.position = c(0.6, 0.7),
legend.direction = "horizontal") +
guides(fill = guide_colorbar( barwidth = 7, barheight = 1,
title.position = "top", title.hjust = 0.5) ) +
ggtitle( "Plot of Agreement for Trust Items" )
print( ggheatmap.T )
knowledge <- runif( n = 5, min = .80 , max = 0.99 )
agreement2 <- matrix(
c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) - 1
),
ncol = n
)
c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) - 1
)
c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) - 1 )
agreement2 <- matrix(
c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) * -1 ),
ncol = n
)
a <- c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) * -1 )
a
dim(a)
length(a)
a <-   runif( n = n.cells, min = .80 , max = 0.99 )
length(a)
n <- 6 # note this has to be even for the division below to work
n.cells <- n*n
agreement <- matrix(
runif( n = n.cells, min = .80 , max = 0.99 ),
ncol = n
)
agreement2 <- matrix(
c(
runif( n = n.cells/2, min = .80 , max = 0.99 ),
runif( n = n.cells/2, min = .80 , max = 0.99 ) * -1 ),
ncol = n
)
agreement2
agreement <- agreement2
# ================================================================== #
# Plotting results ----
# Create data for the plot.
dat.for.plot <- function( cormat ){
dd <- as.dist( ( 1-cormat )/2 ) # Use correlation between variables as distance
hc <- hclust( dd )
cormat <-cormat[hc$order, hc$order]
cormat[lower.tri( cormat )] <- NA # set the lower part of the triangle as missing (redundant information)
cor.dat <- melt( cormat, na.rm = TRUE ) # create the dataframe
return( cor.dat )
}
# Assign the agreement matrix to the object to plot
agreement.dat <- dat.for.plot( agreement )
# Plot the agreement scores/correlations
ggheatmap.T <- ggplot( data = agreement.dat, aes( Var2, Var1, fill = value ) ) +
geom_tile( color = "white" ) +
scale_fill_gradient2( low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c( -1,1 ), space = "Lab",
name="Agreement" ) +
theme_minimal() +
coord_fixed() +
theme(
axis.title.x = element_blank(), axis.title.y = element_blank(),
axis.text.x=element_blank(), axis.text.y=element_blank(),
panel.grid.major = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
axis.ticks = element_blank(),
legend.justification = c(1, 0),
legend.position = c(0.6, 0.7),
legend.direction = "horizontal") +
guides(fill = guide_colorbar( barwidth = 7, barheight = 1,
title.position = "top", title.hjust = 0.5) ) +
ggtitle( "Plot of Agreement for Trust Items" )
print( ggheatmap.T )
knowledge <- runif( n = 5, min = .80 , max = 0.99 )
knowledge
knowledgeDat <- runif( n = 5, min = .80 , max = 0.99 )
knowledgeDat
# Add a new variable that ranks responses within each group
knowledgeDat <- knowledgeDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
knowledgeDat <- data.frame(
knowledge = runif( n = 5, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
knowledgeDat <- data.frame(
knowledge = runif( n = n, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
# Add a new variable that ranks responses within each group
knowledgeDat <- knowledgeDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
View(knowledgeDat)
# Create the scatterplot
knowledgePlot <- ggplot( knowledgeDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
geom_hline( data = culturalMeansSds,
aes( yintercept = mean_knowledge, colour = as.factor( culture ) ) ) +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) )
knowledgeDat <- data.frame(
knowledge = runif( n = n, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
# Add a new variable that ranks responses within each group
knowledgeDat <- knowledgeDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
# Create the scatterplot
knowledgePlot <- ggplot( knowledgeDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) )
print( knowledgePlot )
n <- 100 # note this has to be even for the division below to work
knowledgeDat <- data.frame(
knowledge = runif( n = n, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
# Add a new variable that ranks responses within each group
knowledgeDat <- knowledgeDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
# Create the scatterplot
knowledgePlot <- ggplot( knowledgeDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) )
print( knowledgePlot )
knowledgePlot <- ggplot( knowledgeDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( knowledgePlot )
set.seed( 221122021185 )
set.seed( 2468 )
hetConDat <- data.frame(
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
hetConDat
set.seed( 2468 )
n <- 100
noConDat <- data.frame(
knowledge = runif( n = n, min = .00 , max = 0.30 ),
culture = rep( 1, n )
)
conDat <- data.frame(
knowledge = runif( n = n, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
hetConDat <- data.frame(
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
hetConNoDat <- data.frame(
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
knowledge = runif( n = n/2, min = .00 , max = 0.30 ),
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
knowledgeDat <- noConDat
# Add a new variable that ranks responses within each group
knowledgeDat <- knowledgeDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
# Create the scatterplot
knowledgePlot <- ggplot( knowledgeDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( knowledgePlot )
# Add a new variable that ranks responses within each group
noConDat <- noConDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
# Create the scatterplot
noConPlot <- ggplot( noConDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( noConPlot )
# Add a new variable that ranks responses within each group
noConDat <- noConDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
conDat <- conDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
hetConDat <- hetConDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
hetConNoDat <- hetConNoDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
ConPlot <- ggplot( conDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( ConPlot )
hetConPlot <- ggplot( hetConDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( hetConPlot )
hetConNoPlot <- ggplot( hetConNoDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( hetConNoPlot )
hetConNoDat <- data.frame(
knowledge = runif( n = n/2, min = .80 , max = 0.99 ),
knowledge = runif( n = n/2, min = .00 , max = 0.30 ),
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
hetConNoDat
set.seed( 2468 )
n <- 100
noConDat <- data.frame(
knowledge = runif( n = n, min = .00 , max = 0.30 ),
culture = rep( 1, n )
)
conDat <- data.frame(
knowledge = runif( n = n, min = .80 , max = 0.99 ),
culture = rep( 1, n )
)
hetConDat <- data.frame(
knowledge = c( runif( n = n/2, min = .80 , max = 0.99 ), runif( n = n/2, min = .80 , max = 0.99 ) ) ,
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
hetConNoDat <- data.frame(
knowledge = c( runif( n = n/2, min = .80 , max = 0.99 ), runif( n = n/2, min = .00 , max = 0.30 ) ) ,
culture = c( rep( 1, n/2 ), rep( 2, n/2 ) )
)
# Add a new variable that ranks responses within each group
noConDat <- noConDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
conDat <- conDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
hetConDat <- hetConDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
hetConNoDat <- hetConNoDat %>%
arrange( culture, knowledge ) %>%
mutate( rank_knowledge = row_number() )
# Create the scatterplot2
noConPlot <- ggplot( noConDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( noConPlot )
ConPlot <- ggplot( conDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( ConPlot )
hetConPlot <- ggplot( hetConDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( hetConPlot )
hetConNoPlot <- ggplot( hetConNoDat,
aes( x = rank_knowledge,
y = knowledge,
color = as.factor( culture ) ) ) +
geom_point() +
labs( title = "Scatterplot of Responses by Group",
x = "Respondents",
y = "Knowledge/Expertise") +
theme_minimal() +
theme( legend.position = "top",
axis.text.x = element_blank() ) +
guides( color = guide_legend( title = "Group" ) ) +
scale_y_continuous( limits = c( 0, 1 ) )
print( hetConNoPlot )
grid.arrange( noConPlot, ConPlot, hetConPlot, hetConNoPlot, nrow = 2, ncol = 2 )
library(gridExtra)
grid.arrange( noConPlot, ConPlot, hetConPlot, hetConNoPlot, nrow = 2, ncol = 2 )
